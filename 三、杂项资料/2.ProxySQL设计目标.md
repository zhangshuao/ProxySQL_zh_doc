# ProxySQL设计目标

## ProxySQL关键设计目标

    ProxySQL的构建考虑了几个关键的设计选择。
    
## 最大正常运行时间

    由于ProxySQL是一个代理，因此预计它将在尽可能接近100%的时间内出现。这意味着在涉及停机时，应以不同方式处理常见的可疑事件：
    
    * 配置更改. 这通常是通过更改配置文件并重新启动守护进程来完成的。在ProxySQL中，根据设计，用户可以通过管理界面修改大多数配置变量，而无需重新启动服务器。可在运行时修改的示例：
    
        * ProxySQL正在侦听的接口
        * ProxySQL正在连接的后端服务器
        * ProxySQL执行的不同操作的超时
    
    * crash崩溃. ProxySQL有一套广泛的集成测试，使用Docker运行，以确保它不会崩溃。
    此外，每个主要版本都使用sysbench进行性能测试，并使用valgrind进行内存泄漏测试。
    除此之外，还实现了一个angel进程，在需要时监视并重新启动ProxySQL，以便在停机时间最终发生时将停机时间降至最低。

## 最大可扩展性

    在与ProxySQL交互时，我们希望尽快运行几个关键场景：
    
    * 是时候完成与它的新MySQL连接了：这就是为什么ProxySQL有一个线程池，所有线程都通过系统调用accept()等待接收新连接。
    因此，更快地建立新TCP连接的概率增加。
    
    * 连接到MySQL后端的时间到了：这就是为什么ProxySQL有一个后端连接池，根据配置，它在其中保留一些到后端服务器的空闲连接。
    当它需要向这些服务器发送数据包时，大部分时间连接已经打开。
    
    * 多核可伸缩性：ProxySQL采用多线程设计，所有线程都执行相同的操作（在后端服务器和MySQL客户端连接之间来回封送消息），
    我们的测试表明，它可以很好地随核数扩展。

## 级联可能性

    ProxySQL可以根据需要级联到任意多个层。
    例如，一种常见的场景是让ProxySQL实例尽可能靠近运行应用程序的服务器，指向另一个中间层的ProxySQL服务器集群，
    该集群将所有流量路由到后端MySQL服务器。

    A->P1-–>{P2，P3，P4..}-->{B1，B2，B3，..}
    
    这种情况下的优点是，考虑到应用程序不是单点故障，它对MySQL访问是完全容错的。
    应用程序无需在应用程序级别进行修改，即可连接到代理群集而不是单个代理群集。
    如果中间层的任何代理出现故障，P1代理将检测到该故障，并将通过其他代理路由流量。
    如果后端B1、B2、B3……中的任何一个失败，那么中间层代理将以对P1透明的方式处理作业。
